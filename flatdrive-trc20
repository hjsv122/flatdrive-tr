flatdrive-trc20/
â”‚
â”œâ”€ package.json
â”‚    {
â”‚      "name": "flatdrive-trc20",
â”‚      "version": "1.0.0",
â”‚      "private": true,
â”‚      "scripts": {
â”‚        "start": "node server.js"
â”‚      },
â”‚      "dependencies": {
â”‚        "cors": "^2.8.5",
â”‚        "dotenv": "^16.4.5",
â”‚        "express": "^4.19.2",
â”‚        "tronweb": "^5.3.0"
â”‚      }
â”‚    }
â”‚
â”œâ”€ .env.example
â”‚    # Ø¶Ø¹ Ù‡Ù†Ø§ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§Øµ Ù„Ù…Ø­ÙØ¸Ø© Ø®Ø§Ø¯Ù… TRON
â”‚    PRIVATE_KEY=
â”‚
â”‚    # Ø¹Ù†ÙˆØ§Ù† Ø¹Ù‚Ø¯ USDT TRC20 Ø¹Ù„Ù‰ Ø´Ø¨ÙƒØ© TRON (Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø§Ù„Ø±Ø³Ù…ÙŠ)
â”‚    USDT_CONTRACT=TXLAQ63Xg1NAzckPwKHvzw7CSEmLMEqcdj
â”‚
â”‚    # Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© TRON
â”‚    TRON_FULL_NODE=https://api.trongrid.io
â”‚    TRON_SOLIDITY_NODE=https://api.trongrid.io
â”‚    TRON_EVENT_SERVER=https://api.trongrid.io
â”‚
â”‚    # Ø±Ø³ÙˆÙ… Ø³Ø­Ø¨ Ù…Ù†Ø·Ù‚ÙŠØ© (TRX)
â”‚    WITHDRAW_FEE_TRX=5
â”‚
â”‚    # Ù…Ù†ÙØ° Ø§Ù„Ø®Ø§Ø¯Ù…
â”‚    PORT=8080
â”‚
â”œâ”€ server.js
â”‚    const express = require('express');
â”‚    const cors = require('cors');
â”‚    const TronWeb = require('tronweb');
â”‚    require('dotenv').config();
â”‚
â”‚    const app = express();
â”‚    app.use(cors());
â”‚    app.use(express.json());
â”‚    app.use(express.static('frontend'));
â”‚
â”‚    const FULL_NODE = process.env.TRON_FULL_NODE || 'https://api.trongrid.io';
â”‚    const PRIVATE_KEY = (process.env.PRIVATE_KEY || '').trim();
â”‚    const USDT_CONTRACT = process.env.USDT_CONTRACT || 'TXLAQ63Xg1NAzckPwKHvzw7CSEmLMEqcdj';
â”‚    const WITHDRAW_FEE_TRX = Number(process.env.WITHDRAW_FEE_TRX || 5);
â”‚
â”‚    if (!PRIVATE_KEY) {
â”‚      console.error(' [ERROR] PRIVATE_KEY ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØªÙ‡ ÙÙŠ .env');
â”‚    }
â”‚
â”‚    const tronWeb = new TronWeb({ fullHost: FULL_NODE, privateKey: PRIVATE_KEY || undefined });
â”‚
â”‚    // Ø±ØµÙŠØ¯ Ø±Ø³ÙˆÙ… Ø§Ù„Ø®Ø§Ø¯Ù… (Ù…Ù†Ø·Ù‚ÙŠ / Ø¯Ø§Ø®Ù„ÙŠ)
â”‚    let serverFeePoolTRX = 0;
â”‚
â”‚    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ù…Ù† Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§Øµ
â”‚    async function getServerAddress() {
â”‚      try {
â”‚        if (!PRIVATE_KEY) return null;
â”‚        const hex = tronWeb.address.fromPrivateKey(PRIVATE_KEY);
â”‚        const base58 = tronWeb.address.fromHex(hex);
â”‚        return base58;
â”‚      } catch (e) { return null; }
â”‚    }
â”‚
â”‚    // ØªØ­ÙˆÙŠÙ„ USDT (ÙˆØ­Ø¯Ø©: 6 Ù…Ù†Ø§Ø²Ù„ Ø¹Ø´Ø±ÙŠØ©)
â”‚    function toUsdtUnit(amount) {
â”‚      return BigInt(Math.round(Number(amount) * 1e6));
â”‚    }
â”‚
â”‚    // â€”â€”â€”â€”â€” Endpoints â€”â€”â€”â€”â€”
â”‚    app.get('/api/health', async (req, res) => {
â”‚      const addr = await getServerAddress();
â”‚      res.json({ ok: true, serverAddress: addr, feePoolTRX: serverFeePoolTRX });
â”‚    });
â”‚
â”‚    app.post('/api/fund-fee-pool', (req, res) => {
â”‚      const { amountTRX } = req.body || {};
â”‚      const amt = Number(amountTRX);
â”‚      if (!amt || amt <= 0) return res.status(400).json({ ok: false, error: 'amountTRX Ù…Ø·Ù„ÙˆØ¨ > 0' });
â”‚      serverFeePoolTRX += amt;
â”‚      return res.json({ ok: true, feePoolTRX: serverFeePoolTRX });
â”‚    });
â”‚
â”‚    app.get('/api/fee-pool', (req, res) => {
â”‚      res.json({ ok: true, feePoolTRX: serverFeePoolTRX });
â”‚    });
â”‚
â”‚    app.post('/api/withdraw', async (req, res) => {
â”‚      try {
â”‚        const { to, amountUSDT } = req.body || {};
â”‚        if (!to || typeof to !== 'string' || !to.startsWith('T')) return res.status(400).json({ ok: false, error: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ØºÙŠØ± ØµØ§Ù„Ø­' });
â”‚
â”‚        const amt = Number(amountUSDT);
â”‚        if (!amt || amt <= 0) return res.status(400).json({ ok: false, error: 'Ø§Ù„Ù…Ø¨Ù„Øº ØºÙŠØ± ØµØ§Ù„Ø­' });
â”‚
â”‚        if (serverFeePoolTRX < WITHDRAW_FEE_TRX) return res.status(400).json({ ok: false, error: 'Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ø³ÙˆÙ… ÙƒØ§ÙÙŠØ©' });
â”‚        if (!PRIVATE_KEY) return res.status(500).json({ ok: false, error: 'Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§Øµ ØºÙŠØ± Ù…ÙÙ‡ÙŠØ£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…' });
â”‚
â”‚        const serverAddrHex = tronWeb.address.fromPrivateKey(PRIVATE_KEY);
â”‚        const serverAddrBase58 = tronWeb.address.fromHex(serverAddrHex);
â”‚        const balanceSun = await tronWeb.trx.getBalance(serverAddrBase58);
â”‚        const trxBalance = (balanceSun || 0) / 1e6;
â”‚        if (trxBalance < 0.1) console.warn('[WARN] Ø±ØµÙŠØ¯ TRX Ù…Ù†Ø®ÙØ¶ ÙˆÙ‚Ø¯ ØªÙØ´Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù„Ø³Ù„Ø©');
â”‚
â”‚        const contract = await tronWeb.contract().at(USDT_CONTRACT);
â”‚        const tx = await contract.transfer(to, toUsdtUnit(amt)).send({ feeLimit: 15_000_000 });
â”‚
â”‚        serverFeePoolTRX -= WITHDRAW_FEE_TRX;
â”‚        return res.json({ ok: true, txId: tx, feePoolTRX: serverFeePoolTRX });
â”‚
â”‚      } catch (e) {
â”‚        console.error('withdraw error', e?.message || e);
â”‚        return res.status(500).json({ ok: false, error: e?.message || String(e) });
â”‚      }
â”‚    });
â”‚
â”‚    app.post('/api/sync-counters', (req, res) => {
â”‚      return res.json({ ok: true });
â”‚    });
â”‚
â”‚    const PORT = Number(process.env.PORT || 8080);
â”‚    app.listen(PORT, () => {
â”‚      console.log(FlatDrive TRC20 server listening on port ${PORT});
â”‚    });
â”‚
â”œâ”€ README.md
â”‚    # FlatDrive TRC20
â”‚    Ù„Ø¹Ø¨Ø© Ø¨Ø³ÙŠØ·Ø© Ù…Ø¹ ØªÙƒØ§Ù…Ù„ USDT TRC20 ÙˆØ³ÙŠØ±ÙØ± Node.js
â”‚
â””â”€ frontend/
â”œâ”€ index.html
â”‚    <!doctype html>
â”‚    <html lang="ar">
â”‚    <head>
â”‚      <meta charset="utf-8">
â”‚      <meta name="viewport" content="width=device-width, initial-scale=1">
â”‚      <title>FlatDrive â€” TRC20</title>
â”‚      <link rel="stylesheet" href="styles.css">
â”‚    </head>
â”‚    <body>
â”‚    <div class="game-container">
â”‚      <h1>ğŸš— FlatDrive â€” Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© TRC20</h1>
â”‚      <div class="info">
â”‚        <div>TRX Ø§Ù„Ù…ÙƒØªØ³Ø¨: <strong id="trxEarned">0</strong></div>
â”‚        <div>Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©: <span id="distance">0</span> Ù…ØªØ±</div>
â”‚        <div>Ø±ØµÙŠØ¯ Ø¯Ø§Ø®Ù„ÙŠ (USDT): <span id="wallet">0.00</span></div>
â”‚        <div>ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© (USDT): <span id="gameFund">0.00</span></div>
â”‚        <div>Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø®Ø§Ø¯Ù… (TRX): <span id="serverWallet">0.00</span></div>
â”‚        <div>Ø§Ù„Ø­Ø§Ù„Ø©: <span id="status">Ù…ØªÙˆÙ‚ÙØ©</span></div>
â”‚      </div>
â”‚      <canvas id="gameCanvas"></canvas>
â”‚      <div class="controls">
â”‚        <select id="carColor">
â”‚          <option value="#ff6b6b">Ø£Ø­Ù…Ø±</option>
â”‚          <option value="#4ade80">Ø£Ø®Ø¶Ø±</option>
â”‚          <option value="#3b82f6">Ø£Ø²Ø±Ù‚</option>
â”‚          <option value="#facc15">Ø£ØµÙØ±</option>
â”‚        </select>
â”‚        <button id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</button>
â”‚        <button id="stopBtn">ØªÙˆÙ‚Ù</button>
â”‚        <button id="collectBtn">Ø§Ø¬Ù…Ø¹ (ØªØ­ÙˆÙŠÙ„)</button>
â”‚        <button id="convertFund">ØªØ­ÙˆÙŠÙ„ ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
â”‚      </div>
â”‚      <div class="fund-panel">
â”‚        <h2>ØªÙ…ÙˆÙŠÙ„ Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø®Ø§Ø¯Ù…</h2>
â”‚        <input id="fundAmount" type="number" min="0" placeholder="ÙƒÙ… TRX ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ØŸ">
â”‚        <button id="fundServerBtn">Ø¥ÙŠØ¯Ø§Ø¹</button>
â”‚      </div>
â”‚      <div class="withdraw-panel">
â”‚        <h2>Ø·Ù„Ø¨ Ø³Ø­Ø¨</h2>
â”‚        <input id="toAddress" placeholder="Ø¹Ù†ÙˆØ§Ù† TRX ÙŠØ¨Ø¯Ø£ Ø¨Ù€ T..." />
â”‚        <input id="amount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº USDT" />
â”‚        <button id="reqWithdraw">Ø§Ø·Ù„Ø¨ Ø³Ø­Ø¨</button>
â”‚      </div>
â”‚    </div>
â”‚    <script src="app.js"></script>
â”‚    </body>
â”‚    </html>
â”‚
â”œâ”€ styles.css
â”‚    body {
â”‚      font-family: Arial, sans-serif;
â”‚      background: #0f172a;
â”‚      color: #e6eef8;
â”‚      padding: 20px;
â”‚      display: flex;
â”‚      justify-content: center;
â”‚    }
â”‚
â”‚    .game-container {
â”‚      width: 760px;
â”‚      background: #0b1220;
â”‚      padding: 18px;
â”‚      border-radius: 10px;
â”‚      box-shadow: 0 6px 24px rgba(2, 6, 23, 0.6);
â”‚    }
â”‚
â”‚    h1 { font-size: 20px; margin-bottom: 10px; }
â”‚
â”‚    .info { display: flex; flex-wrap: wrap; justify-content: space-between; background: #071026; padding: 10px; border-radius: 8px; margin-bottom: 10px; }
â”‚
â”‚    canvas { width: 100%; height: 140px; background: #02111b; border-radius: 8px; display: block; margin: 12px 0; }
â”‚
â”‚    .controls, .fund-panel, .withdraw-panel { margin-bottom: 16px; }
â”‚
â””â”€ app.js
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const distanceEl = document.getElementById("distance");
const trxEl = document.getElementById("trxEarned");
const walletEl = document.getElementById("wallet");
const gameFundEl = document.getElementById("gameFund");
const serverWalletEl = document.getElementById("serverWallet");
const statusEl = document.getElementById("status");

let running = false;
let distance = 0;
let earnedTRX = 0;
let walletUSDT = 0;
let gameFundUSDT = 0;

let carColor = "#ff6b6b";    

 document.getElementById("carColor").addEventListener("change", e => {    
   carColor = e.target.value;    
 });    

 document.getElementById("startBtn").onclick = () => {    
   running = true;    
   statusEl.innerText = "ÙŠØ¹Ù…Ù„ ğŸš€";    
 };    

 document.getElementById("stopBtn").onclick = () => {    
   running = false;    
   statusEl.innerText = "Ù…ØªÙˆÙ‚ÙØ© â›”";    
 };    

 document.getElementById("collectBtn").onclick = () => {    
   if (earnedTRX > 0) {    
     walletUSDT += earnedTRX * 0.1; // ØªØ­ÙˆÙŠÙ„ Ø¨Ø³ÙŠØ·    
     earnedTRX = 0;    
     updateUI();    
   }    
 };    

 document.getElementById("convertFund").onclick = () => {    
   if (walletUSDT > 0) {    
     gameFundUSDT += walletUSDT;    
     walletUSDT = 0;    
     updateUI();    
   }    
 };    

 document.getElementById("fundServerBtn").onclick = async () => {    
   const amt = Number(document.getElementById("fundAmount").value);    
   if (amt > 0) {    
     const res = await fetch("/api/fund-fee-pool", {    
       method: "POST",    
       headers: { "Content-Type": "application/json" },    
       body: JSON.stringify({ amountTRX: amt })    
     });    
     const data = await res.json();    
     if (data.ok) {    
       serverWalletEl.innerText = data.feePoolTRX.toFixed(2);    
     }    
   }    
 };    

 document.getElementById("reqWithdraw").onclick = async () => {    
   const to = document.getElementById("toAddress").value;    
   const amt = Number(document.getElementById("amount").value);    
   if (to && amt > 0) {    
     const res = await fetch("/api/withdraw", {    
       method: "POST",    
       headers: { "Content-Type": "application/json" },    
       body: JSON.stringify({ to, amountUSDT: amt })    
     });    
     const data = await res.json();    
     alert(JSON.stringify(data));    
   }    
 };    

 function updateUI() {    
   distanceEl.innerText = distance.toFixed(0);    
   trxEl.innerText = earnedTRX.toFixed(2);    
   walletEl.innerText = walletUSDT.toFixed(2);    
   gameFundEl.innerText = gameFundUSDT.toFixed(2);    
 }    

 function loop() {    
   if (running) {    
     distance += 0.5;    
     earnedTRX += 0.01;    
     ctx.clearRect(0, 0, canvas.width, canvas.height);    
     ctx.fillStyle = carColor;    
     ctx.fillRect(50, 50, 40, 20);    
     updateUI();    
   }    
   requestAnimationFrame(loop);    
 }    
 loop();


