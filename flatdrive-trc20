my-app/
â”‚
â”œâ”€â”€ .gitignore
node_modules/
.env

â”œâ”€â”€ package.json
{
"name": "flatdrive-trc20",
"version": "1.0.0",
"private": true,
"scripts": {
"start": "node server.js"
},
"dependencies": {
"cors": "^2.8.5",
"dotenv": "^16.4.5",
"express": "^4.19.2",
"tronweb": "^5.3.0"
}
}

â”œâ”€â”€ .env.example
PRIVATE_KEY=
USDT_CONTRACT=TXLAQ63Xg1NAzckPwKHvzw7CSEmLMEqcdj
TRON_FULL_NODE=https://api.trongrid.io
WITHDRAW_FEE_TRX=5
PORT=8080

â”œâ”€â”€ server.js
const express = require('express');
const cors = require('cors');
const TronWeb = require('tronweb');
require('dotenv').config();

const app = express();
app.use(cors());
app.use(express.json());
app.use(express.static('frontend'));

const FULL_NODE = process.env.TRON_FULL_NODE || 'https://api.trongrid.io';
const PRIVATE_KEY = (process.env.PRIVATE_KEY || '').trim();
const USDT_CONTRACT = process.env.USDT_CONTRACT || 'TXLAQ63Xg1NAzckPwKHvzw7CSEmLMEqcdj';
const WITHDRAW_FEE_TRX = Number(process.env.WITHDRAW_FEE_TRX || 5);

const tronWeb = new TronWeb({ fullHost: FULL_NODE, privateKey: PRIVATE_KEY || undefined });
let serverFeePoolTRX = 0;

async function getServerAddress() {
try {
if (!PRIVATE_KEY) return null;
const hex = tronWeb.address.fromPrivateKey(PRIVATE_KEY);
const base58 = tronWeb.address.fromHex(hex);
return base58;
} catch {
return null;
}
}

function toUsdtUnit(amount) {
return BigInt(Math.round(Number(amount) * 1e6));
}

app.get('/api/health', async (req, res) => {
res.json({ ok: true, serverAddress: await getServerAddress(), feePoolTRX: serverFeePoolTRX });
});

app.post('/api/fund-fee-pool', (req, res) => {
const amt = Number((req.body || {}).amountTRX);
if (!amt || amt <= 0) return res.status(400).json({ ok: false, error: 'amountTRX Ù…Ø·Ù„ÙˆØ¨ > 0' });
serverFeePoolTRX += amt;
return res.json({ ok: true, feePoolTRX: serverFeePoolTRX });
});

app.get('/api/fee-pool', (req, res) => {
res.json({ ok: true, feePoolTRX: serverFeePoolTRX });
});

app.post('/api/withdraw', async (req, res) => {
try {
const { to, amountUSDT } = req.body || {};
if (!to || typeof to !== 'string' || !to.startsWith('T')) return res.status(400).json({ ok: false, error: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ØºÙŠØ± ØµØ§Ù„Ø­' });
const amt = Number(amountUSDT);
if (!amt || amt <= 0) return res.status(400).json({ ok: false, error: 'Ø§Ù„Ù…Ø¨Ù„Øº ØºÙŠØ± ØµØ§Ù„Ø­' });

if (serverFeePoolTRX < WITHDRAW_FEE_TRX) return res.status(400).json({ ok: false, error: 'Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ø³ÙˆÙ… ÙƒØ§ÙÙŠØ©' });  
if (!PRIVATE_KEY) return res.status(500).json({ ok: false, error: 'Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§Øµ ØºÙŠØ± Ù…ÙÙ‡ÙŠØ£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…' });  

const contract = await tronWeb.contract().at(USDT_CONTRACT);  
const txId = await contract.transfer(to, toUsdtUnit(amt)).send({ feeLimit: 15_000_000 });  

serverFeePoolTRX -= WITHDRAW_FEE_TRX;  

return res.json({ ok: true, txId, feePoolTRX: serverFeePoolTRX });

} catch (e) {
return res.status(500).json({ ok: false, error: e?.message || String(e) });
}
});

app.post('/api/sync-counters', (req, res) => res.json({ ok: true }));

const PORT = Number(process.env.PORT || 8080);
app.listen(PORT, () => {
console.log(FlatDrive TRC20 server listening on port ${PORT});
});

â”œâ”€â”€ README.md

FlatDrive TRC20 â€” ØªØ´ØºÙŠÙ„ ÙˆØ±ÙØ¹

ØªØ´ØºÙŠÙ„ Ù…Ø­Ù„ÙŠÙ‹Ø§

1. Ø£Ù†Ø´Ø¦ Ù…Ù„Ù .env Ù…Ù† .env.example ÙˆØ¶Ø¹ ÙÙŠÙ‡:
PRIVATE_KEY=Ø¶Ø¹_Ù…ÙØªØ§Ø­_Ù…Ø­ÙØ¸Ø©_Ø§Ù„Ø®Ø§Ø¯Ù…
USDT_CONTRACT=TXLAQ63Xg1NAzckPwKHvzw7CSEmLMEqcdj
TRON_FULL_NODE=https://api.trongrid.io
WITHDRAW_FEE_TRX=5
PORT=8080


2. Ø«Ø¨Ù‘Øª Ø§Ù„Ø­Ø²Ù… ÙˆØ´ØºÙ‘Ù„:
npm install
npm start


3. Ø§ÙØªØ­: http://localhost:8080



Ù†Ø´Ø± Ø¹Ù„Ù‰ Render

New â†’ Web Service â†’ Ø§Ø±Ø¨Ø· Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ù„Ø¯ my-app.

Environment Variables:

PRIVATE_KEY

USDT_CONTRACT

TRON_FULL_NODE

WITHDRAW_FEE_TRX

PORT


Build Command: npm install

Start Command: npm start


> Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¥Ø±Ø³Ø§Ù„ TRC20 Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¨ÙƒØ© ÙŠØªØ·Ù„Ø¨ Ø£Ù† ØªØ­ØªÙˆÙŠ Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø®Ø§Ø¯Ù… Ø¹Ù„Ù‰ TRX ÙƒØ§ÙÙ Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø´Ø¨ÙƒØ©.



â””â”€â”€ frontend/
â”œâ”€â”€ index.html
<!doctype html>

<html lang="ar">    
<head>    
  <meta charset="utf-8">    
  <meta name="viewport" content="width=device-width, initial-scale=1">    
  <title>FlatDrive â€” TRC20</title>    
  <link rel="stylesheet" href="styles.css">    
</head>    
<body>    
<div class="game-container">          
  <h1>ğŸš— FlatDrive â€” Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© TRC20</h1>          
  <div class="info">          
    <div>TRX Ø§Ù„Ù…ÙƒØªØ³Ø¨: <strong id="trxEarned">0</strong></div>          
    <div>Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©: <span id="distance">0</span> Ù…ØªØ±</div>          
    <div>Ø±ØµÙŠØ¯ Ø¯Ø§Ø®Ù„ÙŠ (USDT): <span id="wallet">0.00</span></div>          
    <div>ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© (USDT): <span id="gameFund">0.00</span></div>          
    <div>Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø®Ø§Ø¯Ù… (TRX): <span id="serverWallet">0.00</span></div>          
    <div>Ø§Ù„Ø­Ø§Ù„Ø©: <span id="status">Ù…ØªÙˆÙ‚ÙØ©</span></div>          
  </div>      
  <canvas id="gameCanvas"></canvas>      
  <div class="controls">          
    <select id="carColor">          
      <option value="#ff6b6b">Ø£Ø­Ù…Ø±</option>          
      <option value="#4ade80">Ø£Ø®Ø¶Ø±</option>          
      <option value="#3b82f6">Ø£Ø²Ø±Ù‚</option>          
      <option value="#facc15">Ø£ØµÙØ±</option>          
    </select>          
    <button id="startBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</button>          
    <button id="stopBtn">ØªÙˆÙ‚Ù</button>          
    <button id="collectBtn">Ø§Ø¬Ù…Ø¹ (ØªØ­ÙˆÙŠÙ„)</button>          
    <button id="convertFund">ØªØ­ÙˆÙŠÙ„ ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>          
  </div>        
  <div class="fund-panel">          
    <h2>ØªÙ…ÙˆÙŠÙ„ Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø®Ø§Ø¯Ù…</h2>          
    <input id="fundAmount" type="number" min="0" placeholder="ÙƒÙ… TRX ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ØŸ">          
    <button id="fundServerBtn">Ø¥ÙŠØ¯Ø§Ø¹</button>          
  </div>        
  <div class="withdraw-panel">          
    <h2>Ø·Ù„Ø¨ Ø³Ø­Ø¨</h2>          
    <input id="toAddress" placeholder="Ø¹Ù†ÙˆØ§Ù† TRX ÙŠØ¨Ø¯Ø£ Ø¨Ù€ T..." />          
    <input id="amount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº USDT" />          
    <button id="reqWithdraw">Ø§Ø·Ù„Ø¨ Ø³Ø­Ø¨</button>          
  </div>          
</div>    
<script src="app.js"></script>    
</body>    
</html>  â”œâ”€â”€ styles.css

body {
font-family: Arial, sans-serif;
background: #0f172a;
color: #e6eef8;
padding: 20px;
display: flex;
justify-content: center;
}

.game-container {
width: 760px;
background: #0b1220;
padding: 18px;
border-radius: 10px;
box-shadow: 0 6px 24px rgba(2, 6, 23, 0.6);
}

h1 {
font-size: 20px;
margin-bottom: 10px;
}

.info {
display: flex;
flex-wrap: wrap;
justify-content: space-between;
background: #071026;
padding: 10px;
border-radius: 8px;
margin-bottom: 10px;
}

canvas {
width: 100%;
height: 140px;
background: #02111b;
border-radius: 8px;
display: block;
margin: 12px 0;
}

.controls,
.fund-panel,
.withdraw-panel {
margin-bottom: 16px;
}

button {
background: #0ea5a6;
color: #041014;
border: none;
padding: 8px 12px;
border-radius: 8px;
cursor: pointer;
margin: 4px 0;
}

input,
select {
width: 100%;
padding: 8px;
border-radius: 6px;
border: 1px solid rgba(255, 255, 255, 0.06);
background: #02121a;
color: white;
margin-top: 6px;
}

â””â”€â”€ app.js

document.addEventListener("DOMContentLoaded", () => {
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 720;
canvas.height = 140;

let running = false;
let trxEarned = 0;
let wallet = 0;
let gameFund = 0;
let distance = 0;
let serverWallet = 0;

let carX = 10;
let carColor = '#ff6b6b';

const updateUI = () => {
document.getElementById('trxEarned').textContent = Math.floor(trxEarned);
document.getElementById('wallet').textContent = wallet.toFixed(2);
document.getElementById('gameFund').textContent = gameFund.toFixed(2);
document.getElementById('distance').textContent = distance;
document.getElementById('serverWallet').textContent = serverWallet.toFixed(2);
};

const draw = () => {
ctx.clearRect(0, 0, canvas.width, canvas.height);
ctx.fillStyle = '#08323a';
ctx.fillRect(0, canvas.height - 20, canvas.width, 20);
ctx.fillStyle = carColor;
ctx.fillRect(carX, canvas.height - 44, 60, 28);
ctx.fillStyle = '#061119';
ctx.beginPath();
ctx.arc(carX + 12, canvas.height - 12, 8, 0, Math.PI * 2);
ctx.fill();
ctx.beginPath();
ctx.arc(carX + 48, canvas.height - 12, 8, 0, Math.PI * 2);
ctx.fill();
};

const gameTick = () => {
if (!running) return;
carX += 10;
if (carX > canvas.width) carX = -80;
distance += 10;
if (Math.random() < 0.7) trxEarned += 1;
updateUI();
draw();
requestAnimationFrame(gameTick);
};

document.getElementById('carColor').onchange = e => {
carColor = e.target.value;
};

document.getElementById('startBtn').onclick = () => {
running = true;
document.getElementById('status').textContent = 'ØªØ¹Ù…Ù„';
gameTick();
};

document.getElementById('stopBtn').onclick = () => {
running = false;
document.getElementById('status').textContent = 'Ù…ØªÙˆÙ‚ÙØ©';
};

document.getElementById('collectBtn').onclick = () => {
if (trxEarned < 1) {
alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø±Ø¨Ø§Ø­ Ù„Ø¬Ù…Ø¹Ù‡Ø§.");
return;
}
const rate = 0.1;
const totalUSDT = trxEarned * rate;
const fee = totalUSDT * 0.03;
const netUSDT = totalUSDT - fee;

gameFund += fee;
wallet += netUSDT;
trxEarned = 0;
updateUI();
alert(ØªÙ… ØªØ­ÙˆÙŠÙ„ ${netUSDT.toFixed(2)} USDT Ø¥Ù„Ù‰ Ù…Ø­ÙØ¸ØªÙƒ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© (Ø®ØµÙ… 3% ØªÙ…ÙˆÙŠÙ„).);
};

document.getElementById('convertFund').onclick = () => {
if (gameFund <= 0) {
alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±ØµÙŠØ¯ ÙÙŠ Ù…Ø­ÙØ¸Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„.");
return;
}
wallet += gameFund;
gameFund = 0;
updateUI();
alert("âœ… ØªÙ… ØªØ­ÙˆÙŠÙ„ ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¥Ù„Ù‰ Ù…Ø­ÙØ¸ØªÙƒ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©.");
};

document.getElementById('fundServerBtn').onclick = () => {
const amt = parseFloat(document.getElementById('fundAmount').value);
if (isNaN(amt) || amt <= 0 || amt > trxEarned) {
alert("Ù…Ø¨Ù„Øº ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ø£ÙƒØ¨Ø± Ù…Ù† Ø£Ø±Ø¨Ø§Ø­Ùƒ.");
return;
}
trxEarned -= amt;
serverWallet += amt;
updateUI();
alert(âœ… ØªÙ… ØªØ­ÙˆÙŠÙ„ ${amt} TRX Ø¥Ù„Ù‰ Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø®Ø§Ø¯Ù….);
};

document.getElementById('reqWithdraw').onclick = () => {
const to = document.getElementById('toAddress').value;
const amt = parseFloat(document.getElementById('amount').value);
const fee = 5;

if (!to.startsWith("T") || amt <= 0 || wallet < amt) {
alert("ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ù„Ø±ØµÙŠØ¯.");
return;
}

if (serverWallet < fee) {
alert("Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ø³ÙˆÙ… ÙƒØ§ÙÙŠØ©.");
return;
}

wallet -= amt;
serverWallet -= fee;
updateUI();
alert(âœ… ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø³Ø­Ø¨ ${amt} USDT Ø¥Ù„Ù‰ ${to} ÙˆØªÙ… Ø®ØµÙ… ${fee} TRX Ù…Ù† Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø®Ø§Ø¯Ù….);
};

updateUI();
draw();
});

